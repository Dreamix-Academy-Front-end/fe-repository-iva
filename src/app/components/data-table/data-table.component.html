<div *ngIf="isLoading" class="flex justify-center items-center">
    <span class="loading loading-infinity loading-lg bg-secondary"></span>
</div>


<div *ngIf="!isLoading">
    <app-error-modal *ngIf="error" [errorMessage]="error" (close)="dismissError()"></app-error-modal>

    <div class="relative">
        <div class="mt-4 mr-4">
            <input [(ngModel)]="searchTerm" type="text" placeholder="🔍 Search posts by title..."
                class="input input-bordered w-full max-w-xs" />
        </div>
        <h1>Posts API</h1>
        <div *ngIf="!isLoading" class="overflow-x-auto px-4 lg:px-8">
            <table class="table w-full">
                <thead>
                    <tr class="hover:bg-pink-200 shadow-lg hover:shadow-xl transition-shadow duration-300">
                        <th>ID</th>
                        <th>Title</th>
                        <th>Text</th>
                        <th *ngIf="isLoggedIn$ | async" >Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let post of paginatedPosts()"
                        class="cursor-pointer hover:bg-gray-200">
                        <td>{{ post.id }}</td>
                        <td  (click)="openPost(post)">{{ post.title | capitalize}}</td>
                        <td>{{ post.body | capitalize}}</td>
                        <td *ngIf="isLoggedIn$ | async">
                            <div class="flex justify-center space-x-2">
                                <button (click)="openEditForm(post)" class="btn bg-indigo-200 btn-sm">Edit</button>
                                <button (click)="confirmDelete(post)" class="btn bg-pink-300 btn-sm">Delete</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="btn-group mt-4">
            <button class="btn btn-sm btn-secondary" [disabled]="currentPage === 1" (click)="goToPreviousPage()">
                « Prev
            </button>
            <button class="btn btn-sm btn-secondary" *ngFor="let page of totalPagesArray()" (click)="goToPage(page)"
                [class.btn-active]="currentPage === page">
                {{ page }}
            </button>
            <button class="btn btn-sm btn-secondary" [disabled]="currentPage === totalPages()" (click)="goToNextPage()">
                Next »
            </button>
        </div>

    </div>
    <app-data-details [post]="selectedPost" [visible]="showModal" (onClose)="closeModal()"></app-data-details>
    
    <app-edit-post-form *ngIf="selectedPost && showEditForm" [selectedPost]="selectedPost" (postUpdated)="updatePost($event)"
        (cancelEdit)="closeEditForm()"></app-edit-post-form>

    <app-delete-confirmation [selectedPost]="selectedPost" [showDeleteModal]="showDeleteModal"
        (confirmDelete)="handleDelete()" (cancelDelete)="closeDeleteModal()">
    </app-delete-confirmation>
</div>